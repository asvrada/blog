{"componentChunkName":"component---src-templates-blog-post-js","path":"/heap/","result":{"data":{"site":{"siteMetadata":{"title":"Mindscape"}},"markdownRemark":{"id":"4720831c-636a-595d-9e4e-b868c3eae755","excerpt":"Introduction Heap is a tree based data structure, it is commonly used to implement things like priority queue where sort order is important.  In terms of the…","html":"<h1>Introduction</h1>\n<p>Heap is a tree based data structure, it is commonly used to implement things like priority queue where sort order is important. </p>\n<p>In terms of the implementation of heap, generally we use a complete binary tree represented by a 1D array. This tree representation has following characteristics:</p>\n<ol start=\"0\">\n<li>The value of node is bigger than both of its children (hence a max heap, vice versa)</li>\n<li>The left child of node at index <code class=\"language-text\">i</code> is at index <code class=\"language-text\">i * 2</code></li>\n<li>The right child of node at index <code class=\"language-text\">i</code> is at index <code class=\"language-text\">i * 2 + 1</code></li>\n</ol>\n<p><em>Binary Max Heap and how we store it in an array</em></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/549f1a77506ccd1cd0e26be51a2cd0cf/c2d13/max-heap.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 74.32432432432432%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAACaElEQVQ4y51US4hSURg+V2cspppVRYtAkjZBBbWRaNEsgtoGLQzCVRAYVxBREGRw4SKiTUE+BleCBIKCGxUSdRAHZQRnHF/5YMQXqCgorkK4fefOvbfRZmjogPzn+8+5/+P7/iMh/1ilUon819JoNKRSqfD7/f19Uq/XZclkUkZxKpW63Wq1vufz+XcUTyYTplwuy4AZinFGotHockAE4O3h4aHk83g8vA2FQux0OuUCgcAIcP30d/P5/PwqURFvg8HglW63+yIWi10DlFmtVmWhUNhBYFqhAj95p9N51mg0lPT+eDxm/grm8/kIx3F8i+12+8tsNuMQ8NtZidHFa7TJZbPZMr6RU184HD45jMfjZDgc8ntkXaP24ODAfHx8zEUiESvF4GudJkPVfLtHR0dPUfEvdBRXq9Vr9Gx7e3s562AwOF32JaPReAd2Q3SgmqW2TCaTUqVSXRcxgp5sbDYbGY1G/GWo/BiZWa1Wu0mxwWDYhI+t1WqPBJEU4O19IpHYEgNhIt6AoldSUFwQBZFVq9USnBzGgRXIZikGFTWKcfctVKXnXYph7y4WC45OAEbrIR8IPElioK3PxWKx7ff7t4QPniBJI5PJfBWSPoDvJ3jfoRhjdBVJfsC3azabb5w3PRsr+PIKVqxgShcvZr/fJ6K65mazuQu+7lEMzszIvAul7wvcMDqdjqA1SRiv1ys9BvG18Mvlcsl7vV6HcoVAHwTF6xQjgUnIzFfAsixxOBzEYrFIgZxOJ7Hb7ctKp9Ppl3t7ex/1ev1NirF/nsvlPkHlWxS73W7mwn8KUtQ/mDnrOV50/QZPXHn355euPgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"max heap\"\n        title=\"max heap\"\n        src=\"/blog/static/549f1a77506ccd1cd0e26be51a2cd0cf/fcda8/max-heap.png\"\n        srcset=\"/blog/static/549f1a77506ccd1cd0e26be51a2cd0cf/12f09/max-heap.png 148w,\n/blog/static/549f1a77506ccd1cd0e26be51a2cd0cf/e4a3f/max-heap.png 295w,\n/blog/static/549f1a77506ccd1cd0e26be51a2cd0cf/fcda8/max-heap.png 590w,\n/blog/static/549f1a77506ccd1cd0e26be51a2cd0cf/efc66/max-heap.png 885w,\n/blog/static/549f1a77506ccd1cd0e26be51a2cd0cf/c83ae/max-heap.png 1180w,\n/blog/static/549f1a77506ccd1cd0e26be51a2cd0cf/c2d13/max-heap.png 2560w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n<code class=\"language-text\">heap = [100, 19, 36, 17, 3, 25, 1, 2, 7]</code></p>\n<h1>Operations on heap</h1>\n<p>There are two common operations on a heap.</p>\n<p>Following are codes for a Min Heap, where the parent is smaller than its children. And rather than confuse the future me or readers, I will simply copy &#x26; paste the Python’s official implementation of Heapq here.</p>\n<p>Note when visualize the shift up / down operations, you should imagine a tree where its root is at the bottom, like a real tree, rather than more common one like shown above.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/b3dd508241818251c1edadccdedfbdaa/00602/1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAABQUlEQVQ4y6VTiW7DIAzl/390TVupCUe48fxIyZ1u2iwhG4wf9rMR9Asppcw65zTv936I2Ae0dbYPIdDt9kUxJIoxkJSScsob0AMgwSzbVxe70DAo0jozuCclNQOXI+A+bQRi672jmOI7O8/Bk621Yp9f3b0oGUGPx5O8i/Vi13Wcha2+vn/R86nedk/OxQO/B0AQLrkMY3y1Q4isFy61NjSOhjNNzN1SyaIvSgbh93tXM17LMAyklNnQMpFOn7sMkRLZjJU38AU7pVRBlnvlMELibNbaqwBAA5Cpc/a0CXsRVwM8cZrJ2pFBR9Z5VQVdgor9AJ+tnAtNE1N+vCs+pf8XEa00EN80uEMTwFviwbbW1m8HnzGmNgq8Yt/OMU6IE+2PNicWHO0MFaz9zjkyWs+PYOFxNG8GnOrP/yp1GqlC34cDor2q5+hFAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img\"\n        title=\"img\"\n        src=\"/blog/static/b3dd508241818251c1edadccdedfbdaa/fcda8/1.png\"\n        srcset=\"/blog/static/b3dd508241818251c1edadccdedfbdaa/12f09/1.png 148w,\n/blog/static/b3dd508241818251c1edadccdedfbdaa/e4a3f/1.png 295w,\n/blog/static/b3dd508241818251c1edadccdedfbdaa/fcda8/1.png 590w,\n/blog/static/b3dd508241818251c1edadccdedfbdaa/efc66/1.png 885w,\n/blog/static/b3dd508241818251c1edadccdedfbdaa/c83ae/1.png 1180w,\n/blog/static/b3dd508241818251c1edadccdedfbdaa/00602/1.png 1671w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n<em>Blue subscript is the index</em></p>\n<blockquote>\n<p>Below codes from Python’s implementation of heap:<br>\n<a href=\"https://svn.python.org/projects/python/trunk/Lib/heapq.py\">https://svn.python.org/projects/python/trunk/Lib/heapq.py</a></p>\n</blockquote>\n<h2>Push</h2>\n<p>Append the new item to the end of array, then shift it down if its smaller than its parent.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">heappush</span><span class=\"token punctuation\">(</span>heap<span class=\"token punctuation\">,</span> item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"Push item onto heap, maintaining the heap invariant.\"\"\"</span>\n    heap<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span>\n    _siftdown<span class=\"token punctuation\">(</span>heap<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>heap<span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 'heap' is a heap at all indices >= startpos, except possibly for pos.  pos</span>\n<span class=\"token comment\"># is the index of a leaf with a possibly out-of-order value.  Restore the</span>\n<span class=\"token comment\"># heap invariant.</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">_siftdown</span><span class=\"token punctuation\">(</span>heap<span class=\"token punctuation\">,</span> startpos<span class=\"token punctuation\">,</span> pos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    newitem <span class=\"token operator\">=</span> heap<span class=\"token punctuation\">[</span>pos<span class=\"token punctuation\">]</span>\n    <span class=\"token comment\"># Follow the path to the root, moving parents down until finding a place</span>\n    <span class=\"token comment\"># newitem fits.</span>\n    <span class=\"token keyword\">while</span> pos <span class=\"token operator\">></span> startpos<span class=\"token punctuation\">:</span>\n        parentpos <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>pos <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">>></span> <span class=\"token number\">1</span>\n        parent <span class=\"token operator\">=</span> heap<span class=\"token punctuation\">[</span>parentpos<span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">if</span> newitem <span class=\"token operator\">&lt;</span> parent<span class=\"token punctuation\">:</span>\n            heap<span class=\"token punctuation\">[</span>pos<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> parent\n            pos <span class=\"token operator\">=</span> parentpos\n            <span class=\"token keyword\">continue</span>\n        <span class=\"token keyword\">break</span>\n    heap<span class=\"token punctuation\">[</span>pos<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> newitem</code></pre></div>\n<h2>Pop</h2>\n<p>Remove the head, and put the last element to the head, then shift it up.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">heappop</span><span class=\"token punctuation\">(</span>heap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"Pop the smallest item off the heap, maintaining the heap invariant.\"\"\"</span>\n    lastelt <span class=\"token operator\">=</span> heap<span class=\"token punctuation\">.</span>pop<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>    <span class=\"token comment\"># raises appropriate IndexError if heap is empty</span>\n    <span class=\"token keyword\">if</span> heap<span class=\"token punctuation\">:</span>\n        returnitem <span class=\"token operator\">=</span> heap<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n        heap<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> lastelt\n        _siftup<span class=\"token punctuation\">(</span>heap<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n        returnitem <span class=\"token operator\">=</span> lastelt\n    <span class=\"token keyword\">return</span> returnitem\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">_siftup</span><span class=\"token punctuation\">(</span>heap<span class=\"token punctuation\">,</span> pos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    endpos <span class=\"token operator\">=</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>heap<span class=\"token punctuation\">)</span>\n    startpos <span class=\"token operator\">=</span> pos\n    newitem <span class=\"token operator\">=</span> heap<span class=\"token punctuation\">[</span>pos<span class=\"token punctuation\">]</span>\n    <span class=\"token comment\"># Bubble up the smaller child until hitting a leaf.</span>\n    childpos <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token operator\">*</span>pos <span class=\"token operator\">+</span> <span class=\"token number\">1</span>    <span class=\"token comment\"># leftmost child position</span>\n    <span class=\"token keyword\">while</span> childpos <span class=\"token operator\">&lt;</span> endpos<span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># Set childpos to index of smaller child.</span>\n        rightpos <span class=\"token operator\">=</span> childpos <span class=\"token operator\">+</span> <span class=\"token number\">1</span>\n        <span class=\"token keyword\">if</span> rightpos <span class=\"token operator\">&lt;</span> endpos <span class=\"token keyword\">and</span> <span class=\"token keyword\">not</span> heap<span class=\"token punctuation\">[</span>childpos<span class=\"token punctuation\">]</span> <span class=\"token operator\">&lt;</span> heap<span class=\"token punctuation\">[</span>rightpos<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>\n            childpos <span class=\"token operator\">=</span> rightpos\n        <span class=\"token comment\"># Move the smaller child up.</span>\n        heap<span class=\"token punctuation\">[</span>pos<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> heap<span class=\"token punctuation\">[</span>childpos<span class=\"token punctuation\">]</span>\n        pos <span class=\"token operator\">=</span> childpos\n        childpos <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token operator\">*</span>pos <span class=\"token operator\">+</span> <span class=\"token number\">1</span>\n    <span class=\"token comment\"># The leaf at pos is empty now.  Put newitem there, and bubble it up</span>\n    <span class=\"token comment\"># to its final resting place (by sifting its parents down).</span>\n    heap<span class=\"token punctuation\">[</span>pos<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> newitem\n    _siftdown<span class=\"token punctuation\">(</span>heap<span class=\"token punctuation\">,</span> startpos<span class=\"token punctuation\">,</span> pos<span class=\"token punctuation\">)</span></code></pre></div>\n<h2>Heapify</h2>\n<p>Given any arbitrary array, this function turns it into a Heap, again, a min heap in this implementation.</p>\n<p>Note <code class=\"language-text\">i</code> moves from middle to 0</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">heapify</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"Transform list into a heap, in-place, in O(len(heap)) time.\"\"\"</span>\n    n <span class=\"token operator\">=</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span>\n    <span class=\"token comment\"># Transform bottom-up.  The largest index there's any point to looking at</span>\n    <span class=\"token comment\"># is the largest with a child index in-range, so must have 2*i + 1 &lt; n,</span>\n    <span class=\"token comment\"># or i &lt; (n-1)/2.  If n is even = 2*j, this is (2*j-1)/2 = j-1/2 so</span>\n    <span class=\"token comment\"># j-1 is the largest, which is n//2 - 1.  If n is odd = 2*j+1, this is</span>\n    <span class=\"token comment\"># (2*j+1-1)/2 = j so j-1 is the largest, and that's again n//2-1.</span>\n    <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">reversed</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">xrange</span><span class=\"token punctuation\">(</span>n<span class=\"token operator\">//</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        _siftup<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">)</span></code></pre></div>","frontmatter":{"title":"Heap","date":"September 16, 2019","category":"code"}}},"pageContext":{"slug":"/heap/"}}}